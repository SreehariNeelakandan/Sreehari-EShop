<style>
  .colored-toast.swal2-icon-success {
  background-color: #a5dc86 !important;
}

.colored-toast.swal2-icon-error {
  background-color: #f27474 !important;
}

.colored-toast.swal2-icon-warning {
  background-color: #f8bb86 !important;
}

.colored-toast.swal2-icon-info {
  background-color: #3fc3ee !important;
}

.colored-toast.swal2-icon-question {
  background-color: #87adbd !important;
}

.colored-toast .swal2-title {
  color: white;
}

.colored-toast .swal2-close {
  color: white;
}

.colored-toast .swal2-html-container {
  color: white;
}
</style>










<main class="main">
  <div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
    <div class="container">
      <h1 class="page-title">Wishlist<span>Shop</span></h1>
    </div><!-- End .container -->
  </div><!-- End .page-header -->
  <nav aria-label="breadcrumb" class="breadcrumb-nav">
    <div class="container">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
        <li class="breadcrumb-item"><a href="#">Shop</a></li>
        <li class="breadcrumb-item active" aria-current="page">Wishlist</li>
      </ol>
    </div><!-- End .container -->
  </nav><!-- End .breadcrumb-nav -->

  <div class="page-content">
    <div class="container">
      <% if(product.length){ %> 
      <table class="table table-wishlist table-mobile">
        <thead>
          <tr>
            <th>Product</th>
            <th>Name</th>
            <th>Price</th>
            <th>Stock Status</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% product.forEach(element=>{ %>
          <tr>
            <td class="product-col">
              <div class="product">
                <figure class="product-media">
                  <a href="#">
                    <img src="/productimages/<%=element?.products?.img[0]%> " alt="Product image">
                  </a>
                </figure>

                <!-- <h3 class="product-title">
											<a href="#">Blue utility pinafo</a>
										</h3>End .product-title -->
              </div><!-- End .product -->
            </td>
            <td class="product-title"><%=element?.products?.name  %> </td>
            <td class="price-col"><%=element?.products?.offerprice  %> </td>

            <% if(element?.products?.stock==0){ %>
            <td class="stock-col"><span class="in-stock text-danger">out of stock</span></td>
            <% } else{ %>
            <td class="stock-col"><span class="in-stock text-success">In stock</span></td>

            <% } %>
            <td class="action-col">
              <button class="btn btn-block btn-outline-primary-2" onclick="addToCart('<%=element?.products?._id%>','<%=element?.products?.stock%>')" ><i class="icon-cart-plus"></i>Add to Cart</button>
            </td>
            <td class="remove-col"><button class="btn-remove" onclick="swalpopup('<%=element?._id%>','<%=element.products?._id%>')"  ><i class="icon-close"></i></button></td>
          </tr>
          <% }) %>
        </tbody>
    
      </table><!-- End .table table-wishlist -->
      <% } else {%>
        <h5 class="text-center" style="font-size:40px;" >NO ITEMS:)</h5> 
        <% } %> 
      <div class="wishlist-share">
        <div class="social-icons social-icons-sm mb-2">
          <label class="social-label">Share on:</label>
          <a href="#" class="social-icon" title="Facebook" target="_blank"><i class="icon-facebook-f"></i></a>
          <a href="#" class="social-icon" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>
          <a href="#" class="social-icon" title="Instagram" target="_blank"><i class="icon-instagram"></i></a>
          <a href="#" class="social-icon" title="Youtube" target="_blank"><i class="icon-youtube"></i></a>
          <a href="#" class="social-icon" title="Pinterest" target="_blank"><i class="icon-pinterest"></i></a>
        </div><!-- End .soial-icons -->
      </div><!-- End .wishlist-share -->
    </div><!-- End .container -->
  </div><!-- End .page-content -->
</main><!-- End .main -->

<footer class="footer">
  <div class="footer-middle">
    <div class="container">
      <div class="row">
        <div class="col-sm-6 col-lg-3">
          <div class="widget widget-about">
            <img src="/assets/images/uptownlogo.jpg" class="footer-logo" alt="Footer Logo" width="105" height="25">
            <p>Praesent dapibus, neque id cursus ucibus, tortor neque egestas augue, eu vulputate magna eros eu erat. </p>

            <div class="social-icons">
              <a href="#" class="social-icon" target="_blank" title="Facebook"><i class="icon-facebook-f"></i></a>
              <a href="#" class="social-icon" target="_blank" title="Twitter"><i class="icon-twitter"></i></a>
              <a href="#" class="social-icon" target="_blank" title="Instagram"><i class="icon-instagram"></i></a>
              <a href="#" class="social-icon" target="_blank" title="Youtube"><i class="icon-youtube"></i></a>
              <a href="#" class="social-icon" target="_blank" title="Pinterest"><i class="icon-pinterest"></i></a>
            </div><!-- End .soial-icons -->
          </div><!-- End .widget about-widget -->
        </div><!-- End .col-sm-6 col-lg-3 -->

        <div class="col-sm-6 col-lg-3">
          <div class="widget">
            <h4 class="widget-title">Useful Links</h4><!-- End .widget-title -->

            <ul class="widget-list">
              <li><a href="about.html">About Molla</a></li>
              <li><a href="#">How to shop on Molla</a></li>
              <li><a href="#">FAQ</a></li>
              <li><a href="contact.html">Contact us</a></li>
              <li><a href="login.html">Log in</a></li>
            </ul><!-- End .widget-list -->
          </div><!-- End .widget -->
        </div><!-- End .col-sm-6 col-lg-3 -->

        <div class="col-sm-6 col-lg-3">
          <div class="widget">
            <h4 class="widget-title">Customer Service</h4><!-- End .widget-title -->

            <ul class="widget-list">
              <li><a href="#">Payment Methods</a></li>
              <li><a href="#">Money-back guarantee!</a></li>
              <li><a href="#">Returns</a></li>
              <li><a href="#">Shipping</a></li>
              <li><a href="#">Terms and conditions</a></li>
              <li><a href="#">Privacy Policy</a></li>
            </ul><!-- End .widget-list -->
          </div><!-- End .widget -->
        </div><!-- End .col-sm-6 col-lg-3 -->

        <div class="col-sm-6 col-lg-3">
          <div class="widget">
            <h4 class="widget-title">My Account</h4><!-- End .widget-title -->

            <ul class="widget-list">
              <li><a href="#">Sign In</a></li>
              <li><a href="cart.html">View Cart</a></li>
              <li><a href="#">My Wishlist</a></li>
              <li><a href="#">Track My Order</a></li>
              <li><a href="#">Help</a></li>
            </ul><!-- End .widget-list -->
          </div><!-- End .widget -->
        </div><!-- End .col-sm-6 col-lg-3 -->
      </div><!-- End .row -->
    </div><!-- End .container -->
  </div><!-- End .footer-middle -->

  <div class="footer-bottom">
    <div class="container">
      <p class="footer-copyright">Copyright Â© 2019 Molla Store. All Rights Reserved.</p><!-- End .footer-copyright -->
      <figure class="footer-payments">
        <img src="assets/images/payments.png" alt="Payment methods" width="272" height="20">
      </figure><!-- End .footer-payments -->
    </div><!-- End .container -->
  </div><!-- End .footer-bottom -->
</footer><!-- End .footer -->



<script>

function swalpopup(wishlistId,proId){

  Swal.fire({
  title: 'Are you sure?',
  text: "The Item Will be Deleted!",
  icon: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'Yes, delete it!'
}).then((result) => {
  if (result.isConfirmed) {

    Swal.fire('Removed!','','success').then(()=>{

      removeProduct(wishlistId, proId)
    })
  }
})

}



function removeProduct(wishlistId, proId) {
		$.ajax({
			url: '/remove-wishListProduct',
			data: {
				wishlist: wishlistId,
				product: proId
			},
			method: 'post',
			success: (response) => {
				location.reload()
			}
		})
	}


</script>

<script>
    function addToCart(proId, stock) {
      console.log("proid=>", proId, "stock=>", stock);
      $.ajax({
        url: '/check-cart-quantity/' + proId,
        method: 'get',
        success: (response) => {
          if (response.status) {
            if (stock - response.quantity <= 0) {
            toast2()
            } else {
              $.ajax({
                url: '/add-to-cart/' + proId,
                method: 'get',
  
                success: (response) => {
                  if (response.status) {
                    toast1()
                    let count = $('#cart-count').html()
                    console.log(count, "is count");
                    count = parseInt(count) + 1
                    $('#cart-count').html(count)
  
                  }
                }
              })
            }
  
          } else if (response.status == false && stock == 0) {
           toast2()
          }
          //   user exsist but no cart condition
          else {
            $.ajax({
              url: '/add-to-cart/' + proId,
              method: 'get',
              success: (response) => {
                if (response.status) {
                   toast1()
                  let count = $('#cart-count').html()
                  console.log(count, "is count");
                  count = parseInt(count) + 1
                  $('#cart-count').html(count)
                }
              }
            })
          }
        }
      })
  
  
  
  
    }
   async function toast1()
    {
     const Toast=Swal.mixin({
    toast: true,
    position: 'bottom',
    iconColor: 'white',
    customClass: {
      popup: 'colored-toast'
    },
    showConfirmButton: false,
    timer: 1500,
    timerProgressBar: true
  })
  await Toast.fire({
    icon: 'success',
    title: 'ITEM ADDED TO CART'
  })
    }
  
    async function toast2(){
      const Toast= Swal.mixin({
    toast: true,
    position: 'bottom',
    iconColor: 'white',
    customClass: {
      popup: 'colored-toast'
    },
    showConfirmButton: false,
    timer: 1500,
    timerProgressBar: true
  })
  await Toast.fire({
    icon: 'error',
    title: 'ITEM OUT OF STOCK'
  })
  
    }
  
    function addtowishlist(proId){
  
    $.ajax({
      url:'/add-wishlist/'+proId,
      method:'post',
     success:(response)=>{
      if(response.status=='success')
      {
        return alert('item added')
      }else{
        return alert('item already exist')
      }
     }
    })
    }
  </script>